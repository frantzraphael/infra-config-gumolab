#!/bin/bash

# Colors
GREEN="\e[32m"
RED="\e[31m"
CYAN="\e[36m"
GRAY="\e[90m"
RESET="\e[0m"

HOST=$(hostname)
UPTIME=$(uptime -p)
LOAD=$(awk '{print $1}' /proc/loadavg)

MEM_USED=$(free -h | awk '/Mem:/ {print $3}')
MEM_TOTAL=$(free -h | awk '/Mem:/ {print $2}')

DISK_USED=$(df -h / | awk 'NR==2 {print $3}')
DISK_TOTAL=$(df -h / | awk 'NR==2 {print $2}')
TEMP=$(sensors 2>/dev/null | awk '/Package id 0:/ {print $4}')
IP=$(hostname -I | awk '{print $1}')
SWAP=$(free -h | awk '/Swap:/ {print $3 "/" $2}')

check_service() {
  systemctl is-active --quiet "$1" && \
    echo -e "${GREEN}ğŸŸ¢ $1 running${RESET}" || \
    echo -e "${RED}ğŸ”´ $1 stopped${RESET}"
}

check_docker_container() {
  docker ps --format '{{.Names}}' | grep -q "^$1$" && \
    echo -e "${GREEN}ğŸŸ¢ $1 (docker) running${RESET}" || \
    echo -e "${RED}ğŸ”´ $1 (docker) stopped${RESET}"
}

check_tunnel() {
  systemctl is-active --quiet "$1" && \
    echo -e "${GREEN}ğŸŸ¢ $1 tunnel up${RESET}" || \
    echo -e "${RED}ğŸ”´ $1 tunnel down${RESET}"
}


echo -e "${CYAN}ğŸ–¥  $HOST${RESET}"
echo -e "${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
echo -e "â±  Uptime: $UPTIME"
echo -e "ğŸ”¥ CPU Load: $LOAD"
echo -e "ğŸŒ¡  CPU Temp: ${TEMP:-N/A}"
echo -e "ğŸ§  RAM: $MEM_USED / $MEM_TOTAL"
echo -e "ğŸ”€ SWAP: $SWAP"
echo -e "ğŸ’¾ Disk (/): $DISK_USED / $DISK_TOTAL"
echo -e "ğŸŒ IP: $IP"
echo

echo -e "${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
echo -e "ğŸŒ Cloudflare Tunnels"
check_tunnel cloudflared-jellyfin
check_tunnel cloudflared-apps

echo -e "${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
echo -e "${CYAN}ğŸ§© Services${RESET}"
check_service casaos
check_docker_container jellyfin
check_docker_container transmission

